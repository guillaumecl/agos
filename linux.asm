extern agos
global _start

%include "linux.inc"
%include "sdl.inc"

extern SDL_Flip
extern SDL_Quit

section .data
surface:dd 0
palette:dd 0x000000, 0xAA0000, 0x00AA00, 0xAAAA00, 0x0000AA, 0xAA00AA, 0x0055AA, 0xAAAAAA
		dd 0x555555, 0xFF5555, 0x55FF55, 0xFFFF55, 0x5555FF, 0xFF55FF, 0x55FFFF, 0xFFFFFF

		dd 0x000000, 0x141414, 0x202020, 0x2C2C2C, 0x383838, 0x454545, 0x515151, 0x616161
		dd 0x717171, 0x828282, 0x929292, 0xA2A2A2, 0xB6B6B6, 0xCBCBCB, 0xE3E3E3, 0xFFFFFF

		dd 0xFF0000, 0xFF0041, 0xFF007D, 0xFF00BE, 0xFF00FF, 0xBE00FF, 0x7D00FF, 0x4100FF
		dd 0x0000FF, 0x0041FF, 0x007DFF, 0x00BEFF, 0x00FFFF, 0x00FFBE, 0x00FF7D, 0x00FF41
		dd 0x00FF00, 0x41FF00, 0x7DFF00, 0xBEFF00, 0xFFFF00, 0xFFBE00, 0xFF7D00, 0xFF4100

		dd 0xFF7D7D, 0xFF7D9E, 0xFF7DBE, 0xFF7DDF, 0xFF7DFF, 0xDF7DFF, 0xBE7DFF, 0x9E7DFF
		dd 0x7D7DFF, 0x7D9EFF, 0x7DBEFF, 0x7DDFFF, 0x7DFFFF, 0x7DFFDF, 0x7DFFBE, 0x7DFF9E
		dd 0x7DFF7D, 0x9EFF7D, 0xBEFF7D, 0xDFFF7D, 0xFFFF7D, 0xFFDF7D, 0xFFBE7D, 0xFF9E7D

		dd 0xFFB6B6, 0xFFB6C7, 0xFFB6DB, 0xFFB6EB, 0xFFB6FF, 0xEBB6FF, 0xDBB6FF, 0xC7B6FF
		dd 0xB6B6FF, 0xB6C7FF, 0xB6DBFF, 0xB6EBFF, 0xB6FFFF, 0xB6FFEB, 0xB6FFDB, 0xB6FFC7
		dd 0xB6FFB6, 0xC7FFB6, 0xDBFFB6, 0xEBFFB6, 0xFFFFB6, 0xFFEBB6, 0xFFDBB6, 0xFFC7B6

		dd 0x710000, 0x71001C, 0x710038, 0x710055, 0x710071, 0x550071, 0x380071, 0x1C0071
		dd 0x000071, 0x001C71, 0x003871, 0x005571, 0x007171, 0x007155, 0x007138, 0x00711C
		dd 0x007100, 0x1C7100, 0x387100, 0x557100, 0x717100, 0x715500, 0x713800, 0x711C00

		dd 0x713838, 0x713845, 0x713855, 0x713861, 0x713871, 0x613871, 0x553871, 0x453871
		dd 0x383871, 0x384571, 0x385571, 0x386171, 0x387171, 0x387161, 0x387155, 0x387145
		dd 0x387138, 0x457138, 0x557138, 0x617138, 0x717138, 0x716138, 0x715538, 0x714538

		dd 0x715151, 0x715159, 0x715161, 0x715169, 0x715171, 0x695171, 0x615171, 0x595171
		dd 0x515171, 0x515971, 0x516171, 0x516971, 0x517171, 0x517169, 0x517161, 0x517159
		dd 0x517151, 0x597151, 0x617151, 0x697151, 0x717151, 0x716951, 0x716151, 0x715951

		dd 0x410000, 0x410010, 0x410020, 0x410030, 0x410041, 0x300041, 0x200041, 0x100041
		dd 0x000041, 0x001041, 0x002041, 0x003041, 0x004141, 0x004130, 0x004120, 0x004110
		dd 0x004100, 0x104100, 0x204100, 0x304100, 0x414100, 0x413000, 0x412000, 0x411000

		dd 0x412020, 0x412028, 0x412030, 0x412038, 0x412041, 0x382041, 0x302041, 0x282041
		dd 0x202041, 0x202841, 0x203041, 0x203841, 0x204141, 0x204138, 0x204130, 0x204128
		dd 0x204120, 0x284120, 0x304120, 0x384120, 0x414120, 0x413820, 0x413020, 0x412820

		dd 0x412C2C, 0x412C30, 0x412C34, 0x412C3C, 0x412C41, 0x3C2C41, 0x342C41, 0x302C41
		dd 0x2C2C41, 0x2C3041, 0x2C3441, 0x2C3C41, 0x2C4141, 0x2C413C, 0x2C4134, 0x2C4130
		dd 0x2C412C, 0x30412C, 0x34412C, 0x3C412C, 0x41412C, 0x413C2C, 0x41342C, 0x41302C

		dd 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000, 0x000000

section .text
_start:
		SDL_init SDL_INIT_VIDEO

		SDL_set_video_mode 320, 200, 8, SDL_FULLSCREEN

		mov [surface], eax

		SDL_set_colors eax, palette, 0, 256

		mov eax, [surface]
		mov edi, [eax+20]

		mov ebp, flip
		call agos

		mov ecx, 0
.loop:
		dec ecx
		jnz .loop

		call SDL_Quit

end:
		exit 0

flip:
		push dword [surface]
		call SDL_Flip
		add esp, 4
		ret
